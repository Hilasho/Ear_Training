<!DOCTYPE html>
<html lang="he">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Interval Singing Trainer</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: linear-gradient(135deg, #e2e8f0, #cbd5e1);
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      margin: 0;
    }
    .card {
      background: white;
      padding: 30px;
      border-radius: 20px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
      max-width: 700px;
      width: 100%;
      text-align: center;
    }
    button {
      padding: 10px 18px;
      margin: 6px;
      border-radius: 12px;
      border: none;
      cursor: pointer;
      font-size: 14px;
    }
    .primary { background: #2563eb; color: white; }
    .secondary { background: #64748b; color: white; }
    .success { background: #16a34a; color: white; }
    .danger { background: #dc2626; color: white; }
    .outline { background: white; border: 1px solid #ccc; }
    .stats { display: flex; justify-content: space-around; margin-bottom: 20px; }
    .intervals { max-height: 150px; overflow-y: auto; text-align: left; }
  </style>
</head>
<body>
  <div class="card">
    <h2>ðŸŽ¶ Interval Singing Trainer</h2>

    <div class="stats">
      <div>âœ” Correct: <span id="correct">0</span></div>
      <div>âœ˜ Wrong: <span id="wrong">0</span></div>
      <div>Attempts: <span id="attempts">0</span></div>
      <div>Success: <span id="rate">0</span>%</div>
    </div>

    <button class="outline" onclick="resetStats()">Reset Statistics</button>

    <div id="exercise" style="margin-top:20px;"></div>

    <div style="margin-top:15px;">
      <button class="primary" onclick="generateExercise()">New Exercise</button>
      <button class="secondary" onclick="tellMe()">Tell Me</button>
    </div>

    <div style="margin-top:15px;">
      <button class="success" onclick="markCorrect()">I Got It âœ”</button>
      <button class="danger" onclick="markWrong()">I Missed It âœ˜</button>
    </div>

    <div style="margin-top:20px;">
      <label>Octave:
        <select id="octave">
          <option value="3">3</option>
          <option value="4" selected>4</option>
          <option value="5">5</option>
        </select>
      </label>
    </div>
  </div>

<script>
const NOTES = ["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];
const INTERVALS = [
  { name: "Minor 2nd", semitones: 1 },
  { name: "Major 2nd", semitones: 2 },
  { name: "Minor 3rd", semitones: 3 },
  { name: "Major 3rd", semitones: 4 },
  { name: "Perfect 4th", semitones: 5 },
  { name: "Tritone", semitones: 6 },
  { name: "Perfect 5th", semitones: 7 },
  { name: "Minor 6th", semitones: 8 },
  { name: "Major 6th", semitones: 9 },
  { name: "Minor 7th", semitones: 10 },
  { name: "Major 7th", semitones: 11 },
  { name: "Octave", semitones: 12 }
];

let audioCtx;
let currentNoteIndex = null;
let currentInterval = null;
let direction = null;
let correct = 0;
let wrong = 0;

function ensureAudio() {
  if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
}

function playPianoTone(frequency, duration = 1.5) {
  ensureAudio();
  const now = audioCtx.currentTime;
  const harmonics = [1,2,3,4];
  const gains = [1,0.5,0.3,0.15];

  harmonics.forEach((h,i)=>{
    const osc = audioCtx.createOscillator();
    const gainNode = audioCtx.createGain();
    osc.type = "sine";
    osc.frequency.value = frequency*h;
    osc.connect(gainNode);
    gainNode.connect(audioCtx.destination);
    gainNode.gain.setValueAtTime(gains[i], now);
    gainNode.gain.exponentialRampToValueAtTime(0.0001, now+duration);
    osc.start(now);
    osc.stop(now+duration);
  });
}

function noteToFrequency(noteIndex, octave) {
  const a4Index = 9;
  const semitoneDistance = noteIndex - a4Index + (octave - 4)*12;
  return 440*Math.pow(2,semitoneDistance/12);
}

function generateExercise() {
  currentNoteIndex = Math.floor(Math.random()*NOTES.length);
  currentInterval = INTERVALS[Math.floor(Math.random()*INTERVALS.length)];
  direction = Math.random()>0.5?"above":"below";

  const octave = parseInt(document.getElementById("octave").value);
  const freq = noteToFrequency(currentNoteIndex, octave);

  document.getElementById("exercise").innerHTML =
    `Starting note: <strong>${NOTES[currentNoteIndex]}${octave}</strong><br>
     Sing a <strong>${currentInterval.name}</strong> ${direction}`;

  playPianoTone(freq);
}

function tellMe() {
  if(currentNoteIndex===null) return;
  const octave = parseInt(document.getElementById("octave").value);
  const baseFreq = noteToFrequency(currentNoteIndex, octave);
  const semitoneChange = direction==="above"?currentInterval.semitones:-currentInterval.semitones;
  const targetFreq = baseFreq*Math.pow(2,semitoneChange/12);
  playPianoTone(baseFreq);
  setTimeout(()=>playPianoTone(targetFreq),1200);
}

function updateStats(){
  const attempts = correct+wrong;
  document.getElementById("correct").innerText=correct;
  document.getElementById("wrong").innerText=wrong;
  document.getElementById("attempts").innerText=attempts;
  document.getElementById("rate").innerText=attempts?Math.round((correct/attempts)*100):0;
}

function playSuccess(){ playPianoTone(880,0.4); setTimeout(()=>playPianoTone(1100,0.4),200); }
function playFail(){ playPianoTone(220,0.6); }

function markCorrect(){ correct++; updateStats(); playSuccess(); setTimeout(generateExercise,800); }
function markWrong(){ wrong++; updateStats(); playFail(); setTimeout(generateExercise,800); }

function resetStats(){ correct=0; wrong=0; updateStats(); }
</script>
</body>
</html>
