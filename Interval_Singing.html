<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>ðŸŽµ Interval Singing Trainer</title>
<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;600;800;900&display=swap" rel="stylesheet">
<style>
:root {
  --sunflower: #FFCC00;
  --hot-pink: #FF0066;
  --electric-blue: #4361EE;
  --electric-purple: #9D4EDD; /* ×¦×‘×¢ ×¡×’×•×œ ×—×“×© */
  --mint-green: #00F5D4;
  --punk-black: #1A1A1D;
  --off-white: #FDFDFF;
  
  --border-thick: clamp(2px, 0.5vh, 3px) solid var(--punk-black);
  --shadow-hard: 4px 4px 0px var(--punk-black);
  --shadow-active: 1px 1px 0px var(--punk-black);
  --radius-cute: 16px;
  --radius-pill: 50px;
}

* { 
  box-sizing: border-box; 
  font-family: 'Outfit', system-ui, sans-serif;
}

body {
  margin: 0;
  background-color: var(--off-white);
  background-image: 
    linear-gradient(45deg, #e5e5f0 25%, transparent 25%, transparent 75%, #e5e5f0 75%, #e5e5f0),
    linear-gradient(45deg, #e5e5f0 25%, transparent 25%, transparent 75%, #e5e5f0 75%, #e5e5f0);
  background-size: 40px 40px;
  background-position: 0 0, 20px 20px;
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100dvh; /* Locks to screen height */
  overflow: hidden; /* No scroll on body */
  padding: 10px;
  color: var(--punk-black);
}

/* Animations */
@keyframes float-in {
  0% { opacity: 0; transform: translateY(20px) scale(0.98); }
  100% { opacity: 1; transform: translateY(0) scale(1); }
}

@keyframes stripe-scroll {
  0% { background-position: 0 0; }
  100% { background-position: 40px 0; }
}

.card {
  width: 100%;
  max-width: 450px;
  height: 100%;
  max-height: 800px;
  background: var(--sunflower);
  border: var(--border-thick);
  border-radius: 20px;
  padding: 16px;
  box-shadow: var(--shadow-hard);
  display: flex;
  flex-direction: column;
  gap: 10px; /* Tight gap to fit everything */
  position: relative;
  animation: float-in 0.5s ease-out forwards;
}

/* Header & Nav */
.header-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.btn-back {
  background: var(--off-white);
  color: var(--punk-black);
  border: 2px solid var(--punk-black);
  border-radius: 8px;
  padding: 4px 8px;
  font-weight: 800;
  text-decoration: none;
  font-size: 0.8rem;
  box-shadow: 2px 2px 0px var(--punk-black);
}

h1 {
  margin: 0;
  font-size: clamp(1.5rem, 3vh, 2rem);
  font-weight: 900;
  text-transform: uppercase;
  line-height: 1;
  text-align: right;
  text-shadow: 2px 2px 0px var(--off-white);
}

/* Stats */
.stats {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 6px;
  font-size: 0.7rem;
  font-weight: 800;
}

.stat-badge {
  background: var(--off-white);
  border: 2px solid var(--punk-black);
  border-radius: 8px;
  padding: 4px;
  text-align: center;
  box-shadow: 2px 2px 0px var(--punk-black);
}

.stat-badge strong {
  display: block;
  font-size: 1.1rem;
  color: var(--hot-pink);
  line-height: 1.1;
}

/* Progress Bar */
.progress {
  height: 12px;
  background: var(--off-white);
  border: 2px solid var(--punk-black);
  border-radius: var(--radius-pill);
  overflow: hidden;
}

.progress-bar {
  height: 100%;
  width: 0%;
  background: repeating-linear-gradient(45deg, var(--mint-green), var(--mint-green) 10px, #00dfc0 10px, #00dfc0 20px);
  background-size: 28px 100%;
  border-right: 2px solid var(--punk-black);
  animation: stripe-scroll 1.5s linear infinite;
  transition: width 0.3s ease;
}

/* Exercise Screen - UPDATED: SMALLER TEXT, MORE PADDING */
.exercise {
  flex: 1; /* Takes available space */
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  text-align: center;
  padding: 30px; /* Big padding */
  background: var(--punk-black);
  color: var(--off-white);
  border-radius: var(--radius-cute);
  box-shadow: 4px 4px 0px var(--electric-blue);
  border: 2px solid var(--punk-black);
  transform: rotate(-0.5deg);
}

.ex-label { font-size: 0.8rem; opacity: 0.7; letter-spacing: 1px; text-transform: uppercase; }
.ex-note { font-size: 1.8rem; font-weight: 900; color: var(--sunflower); margin: 5px 0 15px 0; }
.ex-interval { font-size: 1.4rem; font-weight: 900; color: var(--mint-green); line-height: 1.2; }
.ex-dir { font-size: 0.9rem; margin-top: 5px; color: #ddd; }

/* THE BIG GRID - 6 BUTTONS */
.button-grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr); /* 3 Columns */
  grid-template-rows: repeat(2, 1fr);    /* 2 Rows */
  gap: 8px;
  height: 140px; /* Fixed height area for buttons */
}

button.tactile {
  border: 2px solid var(--punk-black);
  border-radius: 12px;
  font-size: 0.85rem;
  font-weight: 900;
  text-transform: uppercase;
  cursor: pointer;
  box-shadow: 3px 3px 0px var(--punk-black);
  transition: all 0.1s;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  padding: 4px;
  line-height: 1.1;
  width: 100%;
  height: 100%; /* Fill the grid cell */
}

button.tactile span { font-size: 1.2rem; display: block; margin-bottom: 2px; }

button.tactile:active { transform: translate(2px, 2px); box-shadow: var(--shadow-active); }

/* Button Colors */
.btn-new { background: var(--off-white); color: var(--punk-black); }
.btn-repeat { background: var(--electric-purple); color: var(--off-white); } /* PURPLE */
.btn-tell { background: var(--electric-blue); color: var(--off-white); }
.btn-correct { background: var(--mint-green); color: var(--punk-black); }
.btn-wrong { background: var(--hot-pink); color: var(--off-white); }
.btn-reset { background: #ddd; color: var(--punk-black); font-size: 0.75rem; border-style: dashed;}

/* Footer: Octave + Feedback */
.footer-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
  height: 40px;
}

.settings-row {
  display: flex;
  align-items: center;
  gap: 5px;
  font-weight: 800;
  font-size: 0.8rem;
  background: var(--off-white);
  padding: 4px 8px;
  border: 2px solid var(--punk-black);
  border-radius: 8px;
}

select {
  padding: 2px;
  border: 1px solid var(--punk-black);
  border-radius: 4px;
  font-weight: 800;
  background: var(--sunflower);
  outline: none;
}

.feedback {
  font-weight: 900;
  font-size: 1.2rem;
  text-transform: uppercase;
  text-align: right;
  flex: 1;
  padding-right: 10px;
  opacity: 0;
}
.feedback.show { opacity: 1; }
.feedback.correct { color: var(--punk-black); text-shadow: 1px 1px 0px var(--mint-green); }
.feedback.wrong { color: var(--punk-black); text-shadow: 1px 1px 0px var(--hot-pink); }

</style>
</head>
<body>

<div class="card">
  
  <div class="header-row">
    <a href="index.html" class="btn-back">â¬… Back</a>
    <h1>Interval<br>Trainer</h1>
  </div>

  <div class="stats">
    <div class="stat-badge">âœ” <strong id="correct">0</strong></div>
    <div class="stat-badge">âœ˜ <strong id="wrong">0</strong></div>
    <div class="stat-badge">Try <strong id="attempts">0</strong></div>
    <div class="stat-badge">% <strong id="rate">0</strong></div>
  </div>

  <div class="progress">
    <div id="progressBar" class="progress-bar"></div>
  </div>

  <div class="exercise" id="exercise">
    <div class="ex-label">Tap New to Start</div>
    <div class="ex-note">ðŸŽ¤</div>
  </div>

  <div class="button-grid">
    <button class="tactile btn-new" onclick="generateExercise()"><span>ðŸŽµ</span>New</button>
    <button class="tactile btn-repeat" onclick="repeatTone()"><span>ðŸ”Š</span>Repeat</button>
    <button class="tactile btn-tell" onclick="tellMe()"><span>ðŸŽ¹</span>Tell Me</button>
    
    <button class="tactile btn-correct" onclick="markCorrect()"><span>âœ”</span>Nailed It</button>
    <button class="tactile btn-wrong" onclick="markWrong()"><span>âœ˜</span>Missed</button>
    <button class="tactile btn-reset" onclick="resetStats()"><span>â†º</span>Reset</button>
  </div>

  <div class="footer-row">
    <div class="settings-row">
      <label>Octave:</label>
      <select id="octave">
        <option value="3">3</option>
        <option value="4" selected>4</option>
        <option value="5">5</option>
      </select>
    </div>
    <div id="feedback" class="feedback"></div>
  </div>

</div>

<script>
const NOTES = ["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];
const INTERVALS = [
  { name: "Minor 2nd", semitones: 1 },
  { name: "Major 2nd", semitones: 2 },
  { name: "Minor 3rd", semitones: 3 },
  { name: "Major 3rd", semitones: 4 },
  { name: "Perfect 4th", semitones: 5 },
  { name: "Tritone", semitones: 6 },
  { name: "Perfect 5th", semitones: 7 },
  { name: "Minor 6th", semitones: 8 },
  { name: "Major 6th", semitones: 9 },
  { name: "Minor 7th", semitones: 10 },
  { name: "Major 7th", semitones: 11 },
  { name: "Octave", semitones: 12 }
];

let audioCtx;
let currentNoteIndex=null;
let currentInterval=null;
let direction=null;
let currentFreq=null;
let correct=0;
let wrong=0;

function ensureAudio(){ if(!audioCtx) audioCtx=new(AudioContext||webkitAudioContext)(); }

function playPianoTone(freq,duration=1.5){
  ensureAudio();
  const now=audioCtx.currentTime;
  [1,2,3,4].forEach((h,i)=>{
    const osc=audioCtx.createOscillator();
    const gainNode=audioCtx.createGain();
    osc.type="sine";
    osc.frequency.value=freq*h;
    osc.connect(gainNode);
    gainNode.connect(audioCtx.destination);
    gainNode.gain.setValueAtTime(0.4/(i+1),now);
    gainNode.gain.exponentialRampToValueAtTime(0.0001,now+duration);
    osc.start(now);
    osc.stop(now+duration);
  });
}

function noteToFrequency(noteIndex,octave){
  const a4Index=9;
  const semitoneDistance=noteIndex-a4Index+(octave-4)*12;
  return 440*Math.pow(2,semitoneDistance/12);
}

function generateExercise(){
  currentNoteIndex=Math.floor(Math.random()*NOTES.length);
  currentInterval=INTERVALS[Math.floor(Math.random()*INTERVALS.length)];
  direction=Math.random()>0.5?"above":"below";
  const octave=parseInt(document.getElementById("octave").value);
  currentFreq=noteToFrequency(currentNoteIndex,octave);
  
  const dirIcon = direction === "above" ? "â¬†ï¸ up" : "â¬‡ï¸ down";
  const exerciseEl = document.getElementById("exercise");
  
  exerciseEl.style.transform = "rotate(-0.5deg) scale(0.98)";
  setTimeout(() => { exerciseEl.style.transform = "rotate(-0.5deg) scale(1)"; }, 100);

  exerciseEl.innerHTML = `
    <div class="ex-label">Start on</div>
    <div class="ex-note">${NOTES[currentNoteIndex]}${octave}</div>
    <div class="ex-label">Sing a</div>
    <div class="ex-interval">${currentInterval.name}</div>
    <div class="ex-dir">${dirIcon}</div>
  `;

  const fb = document.getElementById("feedback");
  fb.className = "feedback"; 
  fb.textContent = "";

  playPianoTone(currentFreq);
}

function repeatTone(){
  if(currentFreq) playPianoTone(currentFreq);
}

function tellMe(){
  if(currentNoteIndex===null) return;
  const semitoneChange=direction==="above"?currentInterval.semitones:-currentInterval.semitones;
  const targetFreq=currentFreq*Math.pow(2,semitoneChange/12);
  playPianoTone(currentFreq);
  setTimeout(()=>playPianoTone(targetFreq),1200);
}

function updateStats(){
  const attempts=correct+wrong;
  document.getElementById("correct").innerText=correct;
  document.getElementById("wrong").innerText=wrong;
  document.getElementById("attempts").innerText=attempts;
  const rate=attempts?Math.round((correct/attempts)*100):0;
  document.getElementById("rate").innerText=rate;
  document.getElementById("progressBar").style.width=rate+"%";
}

function playSuccess(){ playPianoTone(880,0.4); setTimeout(()=>playPianoTone(1100,0.4),200); }
function playFail(){ playPianoTone(220,0.6); }

function showFeedback(text, type) {
  const fb = document.getElementById("feedback");
  fb.textContent = text;
  fb.className = `feedback show ${type}`;
}

function markCorrect(){ 
  if(currentNoteIndex === null) return;
  correct++; updateStats(); showFeedback("Nice! ðŸ”¥", "correct"); 
  playSuccess(); setTimeout(generateExercise, 1200); 
}

function markWrong(){ 
  if(currentNoteIndex === null) return;
  wrong++; updateStats(); showFeedback("Missed ðŸ’€", "wrong"); 
  playFail(); setTimeout(generateExercise, 1200); 
}

function resetStats(){ 
  correct=0; wrong=0; updateStats(); 
  const fb = document.getElementById("feedback");
  fb.className = "feedback"; fb.textContent = ""; 
}
</script>

</body>
</html>
