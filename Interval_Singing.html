<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>üéµ Interval Singing Trainer</title>
<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;600;800;900&display=swap" rel="stylesheet">
<style>
:root {
  --sunflower: #FFCC00;
  --hot-pink: #FF0066;
  --electric-blue: #4361EE;
  --mint-green: #00F5D4;
  --punk-black: #1A1A1D;
  --off-white: #FDFDFF;
  
  --border-thick: clamp(2px, 0.5vh, 4px) solid var(--punk-black);
  --shadow-hard: 6px 6px 0px var(--punk-black);
  --shadow-hover: 8px 8px 0px var(--punk-black);
  --shadow-active: 2px 2px 0px var(--punk-black);
  --radius-cute: 16px;
  --radius-pill: 50px;
}

* { 
  box-sizing: border-box; 
  font-family: 'Outfit', system-ui, sans-serif;
}

body {
  margin: 0;
  background-color: var(--off-white);
  background-image: 
    linear-gradient(45deg, #e5e5f0 25%, transparent 25%, transparent 75%, #e5e5f0 75%, #e5e5f0),
    linear-gradient(45deg, #e5e5f0 25%, transparent 25%, transparent 75%, #e5e5f0 75%, #e5e5f0);
  background-size: 40px 40px;
  background-position: 0 0, 20px 20px;
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100dvh; /* Locks to screen height perfectly */
  overflow: hidden; /* Prevents page scroll */
  padding: clamp(10px, 3vh, 20px);
  color: var(--punk-black);
}

/* Animations */
@keyframes float-in {
  0% { opacity: 0; transform: translateY(30px) scale(0.95); }
  100% { opacity: 1; transform: translateY(0) scale(1); }
}

@keyframes pop-in {
  0% { transform: scale(0.8); opacity: 0; }
  60% { transform: scale(1.1); opacity: 1; }
  100% { transform: scale(1); opacity: 1; }
}

@keyframes wiggle {
  0%, 100% { transform: rotate(15deg); }
  25% { transform: rotate(10deg) scale(1.1); }
  75% { transform: rotate(20deg) scale(1.1); }
}

@keyframes stripe-scroll {
  0% { background-position: 0 0; }
  100% { background-position: 40px 0; }
}

.card {
  width: 100%;
  max-width: 500px;
  max-height: 100%;
  background: var(--sunflower);
  border: var(--border-thick);
  border-radius: 24px;
  padding: clamp(16px, 4vh, 32px) clamp(16px, 4vw, 32px);
  box-shadow: clamp(6px, 1.5vh, 12px) clamp(6px, 1.5vh, 12px) 0px var(--punk-black);
  display: flex;
  flex-direction: column;
  gap: clamp(10px, 2vh, 20px);
  position: relative;
  animation: float-in 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
  overflow-y: auto; /* Internal scroll only if screen is absurdly tiny */
}

/* Hide scrollbar for cleaner look if it does trigger */
.card::-webkit-scrollbar { width: 0px; }

.card::before {
  content: 'üåª VOCALS ‚ö°Ô∏è';
  position: absolute;
  top: clamp(8px, 2vh, 16px);
  right: -30px;
  background: var(--hot-pink);
  color: var(--off-white);
  padding: 4px 40px;
  transform: rotate(15deg);
  font-weight: 900;
  font-size: clamp(0.7rem, 1.5vh, 0.85rem);
  letter-spacing: 1px;
  border: 2px solid var(--punk-black);
  box-shadow: 2px 2px 0 var(--punk-black);
  z-index: 10;
  transition: all 0.3s ease;
}

.card:hover::before { animation: wiggle 0.6s ease-in-out; }

/* Nav */
.top-nav {
  display: flex;
  justify-content: flex-start;
  margin-bottom: clamp(-16px, -2vh, -8px);
  z-index: 1;
}

.btn-back {
  background: var(--off-white);
  color: var(--punk-black);
  border: clamp(2px, 0.4vh, 3px) solid var(--punk-black);
  border-radius: 10px;
  padding: clamp(4px, 1vh, 6px) clamp(10px, 2vw, 14px);
  font-weight: 900;
  text-decoration: none;
  text-transform: uppercase;
  font-size: clamp(0.75rem, 1.5vh, 0.85rem);
  box-shadow: 3px 3px 0px var(--punk-black);
  transition: transform 0.15s, box-shadow 0.15s;
}

.btn-back:hover { transform: translate(-2px, -2px); box-shadow: 5px 5px 0px var(--punk-black); }
.btn-back:active { transform: translate(2px, 2px); box-shadow: 1px 1px 0px var(--punk-black); }

h1 {
  margin: 0;
  font-size: clamp(1.8rem, 4vh, 2.6rem);
  font-weight: 900;
  text-transform: uppercase;
  letter-spacing: -1px;
  line-height: 1.05;
  text-shadow: 3px 3px 0px var(--off-white);
}

/* Stats */
.stats {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: clamp(6px, 1vw, 12px);
  font-size: clamp(0.7rem, 1.5vh, 0.9rem);
  font-weight: 800;
}

.stat-badge {
  background: var(--off-white);
  border: clamp(1px, 0.3vh, 2px) solid var(--punk-black);
  border-radius: 12px;
  padding: clamp(6px, 1.5vh, 10px) 4px;
  text-align: center;
  box-shadow: 2px 2px 0px var(--punk-black);
  transition: transform 0.2s ease;
}

.stat-badge:hover { transform: scale(1.05) rotate(-1deg); }

.stat-badge strong {
  font-size: clamp(1rem, 2vh, 1.3rem);
  display: block;
  color: var(--hot-pink);
  margin-top: 2px;
}

.progress {
  height: clamp(16px, 3vh, 24px);
  background: var(--off-white);
  border: 2px solid var(--punk-black);
  border-radius: var(--radius-pill);
  overflow: hidden;
  box-shadow: inset 3px 3px 0px rgba(0,0,0,0.1);
}

.progress-bar {
  height: 100%;
  width: 0%;
  background: repeating-linear-gradient(45deg, var(--mint-green), var(--mint-green) 15px, #00dfc0 15px, #00dfc0 30px);
  background-size: 42px 100%;
  border-right: 2px solid var(--punk-black);
  transition: width 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
  animation: stripe-scroll 1.5s linear infinite;
}

.btn-reset {
  background: transparent;
  border: 2px dashed var(--punk-black);
  border-radius: var(--radius-pill);
  padding: clamp(4px, 1vh, 8px) 16px;
  font-size: clamp(0.75rem, 1.5vh, 0.85rem);
  font-weight: 800;
  cursor: pointer;
  align-self: center;
  transition: all 0.2s;
  color: var(--punk-black);
}

.btn-reset:hover { background: var(--punk-black); color: var(--sunflower); transform: rotate(2deg); }

/* Exercise Screen */
.exercise {
  flex: 1; /* Allows it to grow/shrink based on remaining height */
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  text-align: center;
  font-size: clamp(1rem, 2.5vh, 1.3rem);
  padding: clamp(12px, 2vh, 24px);
  background: var(--punk-black);
  color: var(--off-white);
  border-radius: var(--radius-cute);
  min-height: clamp(80px, 15vh, 120px);
  gap: 4px;
  transform: rotate(-1deg);
  box-shadow: 6px 6px 0px var(--electric-blue);
  border: 2px solid var(--punk-black);
  transition: transform 0.3s;
}

.exercise:hover { transform: rotate(0deg) scale(1.02); }
.exercise strong { color: var(--sunflower); font-size: clamp(1.4rem, 3.5vh, 2rem); font-weight: 900; letter-spacing: 1px; }

/* Controls Grid */
.controls, .actions {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: clamp(8px, 1.5vh, 12px);
}

button.tactile {
  border: var(--border-thick);
  border-radius: clamp(10px, 2vh, 16px);
  padding: clamp(10px, 2vh, 16px);
  font-size: clamp(0.85rem, 2vh, 1.1rem);
  font-weight: 900;
  text-transform: uppercase;
  cursor: pointer;
  box-shadow: clamp(4px, 1vh, 6px) clamp(4px, 1vh, 6px) 0px var(--punk-black);
  transition: transform 0.1s, box-shadow 0.1s, filter 0.2s;
}

button.tactile:hover:not(:disabled) { transform: translate(-2px, -2px); box-shadow: var(--shadow-hover); filter: brightness(1.05); }
button.tactile:active:not(:disabled) { transform: translate(4px, 4px); box-shadow: var(--shadow-active); }
button.tactile:disabled { opacity: 0.5; cursor: not-allowed; filter: grayscale(0.8); }

.primary { background: var(--off-white); color: var(--punk-black); }
.secondary { background: var(--electric-blue); color: var(--off-white); }
.success { background: var(--mint-green); color: var(--punk-black); }
.danger { background: var(--hot-pink); color: var(--off-white); }

/* Settings */
.settings-row {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 10px;
  font-weight: 800;
  font-size: clamp(0.9rem, 2vh, 1.1rem);
  background: var(--off-white);
  padding: clamp(6px, 1.5vh, 12px);
  border: 2px solid var(--punk-black);
  border-radius: var(--radius-cute);
  box-shadow: 3px 3px 0px var(--punk-black);
}

select {
  padding: clamp(4px, 1vh, 6px) 12px;
  border: 2px solid var(--punk-black);
  border-radius: 8px;
  font-weight: 800;
  font-size: clamp(0.9rem, 2vh, 1rem);
  background: var(--sunflower);
  cursor: pointer;
  outline: none;
}

/* Feedback - Fixed height so it doesn't shift UI */
.feedback {
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: 900;
  height: clamp(30px, 5vh, 40px);
  font-size: clamp(1.2rem, 3vh, 1.6rem);
  text-transform: uppercase;
  letter-spacing: 1px;
  opacity: 0;
}

.feedback.show { animation: pop-in 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; }
.feedback.correct { color: var(--punk-black); text-shadow: 2px 2px 0px var(--mint-green); }
.feedback.wrong { color: var(--punk-black); text-shadow: 2px 2px 0px var(--hot-pink); }

@media(max-width:400px){
  .stats { grid-template-columns: repeat(2, 1fr); }
}
</style>
</head>
<body>

<div class="card">
  <div class="top-nav">
    <a href="index.html" class="btn-back">‚¨Ö Back</a>
  </div>

  <h1>Interval<br>Trainer</h1>

  <div class="stats">
    <div class="stat-badge">‚úî Correct <strong id="correct">0</strong></div>
    <div class="stat-badge">‚úò Wrong <strong id="wrong">0</strong></div>
    <div class="stat-badge">Attempts <strong id="attempts">0</strong></div>
    <div class="stat-badge">Success <strong id="rate">0</strong>%</div>
  </div>

  <div class="progress">
    <div id="progressBar" class="progress-bar"></div>
  </div>

  <button class="btn-reset" onclick="resetStats()">‚Ü∫ Reset Stats</button>

  <div class="exercise" id="exercise">Ready to sing? üé§<br> Hit New Exercise!</div>

  <div class="controls">
    <button class="tactile primary" onclick="generateExercise()">New üéµ</button>
    <button class="tactile secondary" onclick="tellMe()">Tell Me üéπ</button>
  </div>

  <div class="actions">
    <button class="tactile success" onclick="markCorrect()">Nailed It ‚úî</button>
    <button class="tactile danger" onclick="markWrong()">Missed ‚úò</button>
  </div>

  <div class="settings-row">
    <label for="octave">Octave:</label>
    <select id="octave">
      <option value="3">3</option>
      <option value="4" selected>4</option>
      <option value="5">5</option>
    </select>
  </div>

  <div id="feedback" class="feedback"></div>
</div>

<script>
const NOTES = ["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];
const INTERVALS = [
  { name: "Minor 2nd", semitones: 1 },
  { name: "Major 2nd", semitones: 2 },
  { name: "Minor 3rd", semitones: 3 },
  { name: "Major 3rd", semitones: 4 },
  { name: "Perfect 4th", semitones: 5 },
  { name: "Tritone", semitones: 6 },
  { name: "Perfect 5th", semitones: 7 },
  { name: "Minor 6th", semitones: 8 },
  { name: "Major 6th", semitones: 9 },
  { name: "Minor 7th", semitones: 10 },
  { name: "Major 7th", semitones: 11 },
  { name: "Octave", semitones: 12 }
];

let audioCtx;
let currentNoteIndex=null;
let currentInterval=null;
let direction=null;
let correct=0;
let wrong=0;

function ensureAudio(){ if(!audioCtx) audioCtx=new(AudioContext||webkitAudioContext)(); }

function playPianoTone(freq,duration=1.5){
  ensureAudio();
  const now=audioCtx.currentTime;
  [1,2,3,4].forEach((h,i)=>{
    const osc=audioCtx.createOscillator();
    const gainNode=audioCtx.createGain();
    osc.type="sine";
    osc.frequency.value=freq*h;
    osc.connect(gainNode);
    gainNode.connect(audioCtx.destination);
    gainNode.gain.setValueAtTime(0.4/(i+1),now);
    gainNode.gain.exponentialRampToValueAtTime(0.0001,now+duration);
    osc.start(now);
    osc.stop(now+duration);
  });
}

function noteToFrequency(noteIndex,octave){
  const a4Index=9;
  const semitoneDistance=noteIndex-a4Index+(octave-4)*12;
  return 440*Math.pow(2,semitoneDistance/12);
}

function generateExercise(){
  currentNoteIndex=Math.floor(Math.random()*NOTES.length);
  currentInterval=INTERVALS[Math.floor(Math.random()*INTERVALS.length)];
  direction=Math.random()>0.5?"above":"below";
  const octave=parseInt(document.getElementById("octave").value);
  const freq=noteToFrequency(currentNoteIndex,octave);
  
  const dirIcon = direction === "above" ? "‚¨ÜÔ∏è up" : "‚¨áÔ∏è down";
  const exerciseEl = document.getElementById("exercise");
  
  exerciseEl.style.transform = "rotate(-1deg) scale(0.95)";
  setTimeout(() => { exerciseEl.style.transform = "rotate(-1deg) scale(1)"; }, 100);

  exerciseEl.innerHTML = `Start on: <br><strong>${NOTES[currentNoteIndex]}${octave}</strong><br>Sing a <strong>${currentInterval.name}</strong> ${dirIcon}`;

  const fb = document.getElementById("feedback");
  fb.className = "feedback"; 
  void fb.offsetWidth; 
  fb.textContent = "";

  playPianoTone(freq);
}

function tellMe(){
  if(currentNoteIndex===null) return;
  const octave=parseInt(document.getElementById("octave").value);
  const baseFreq=noteToFrequency(currentNoteIndex,octave);
  const semitoneChange=direction==="above"?currentInterval.semitones:-currentInterval.semitones;
  const targetFreq=baseFreq*Math.pow(2,semitoneChange/12);
  playPianoTone(baseFreq);
  setTimeout(()=>playPianoTone(targetFreq),1200);
}

function updateStats(){
  const attempts=correct+wrong;
  document.getElementById("correct").innerText=correct;
  document.getElementById("wrong").innerText=wrong;
  document.getElementById("attempts").innerText=attempts;
  const rate=attempts?Math.round((correct/attempts)*100):0;
  document.getElementById("rate").innerText=rate;
  document.getElementById("progressBar").style.width=rate+"%";
}

function playSuccess(){ playPianoTone(880,0.4); setTimeout(()=>playPianoTone(1100,0.4),200); }
function playFail(){ playPianoTone(220,0.6); }

function showFeedback(text, type) {
  const fb = document.getElementById("feedback");
  fb.className = "feedback"; 
  void fb.offsetWidth; 
  fb.textContent = text;
  fb.className = `feedback show ${type}`;
}

function markCorrect(){ 
  if(currentNoteIndex === null) return;
  correct++; updateStats(); showFeedback("üî• PERFECT!", "correct"); 
  playSuccess(); setTimeout(generateExercise, 1200); 
}

function markWrong(){ 
  if(currentNoteIndex === null) return;
  wrong++; updateStats(); showFeedback("üíÄ OOF, MISSED", "wrong"); 
  playFail(); setTimeout(generateExercise, 1200); 
}

function resetStats(){ 
  correct=0; wrong=0; updateStats(); 
  const fb = document.getElementById("feedback");
  fb.className = "feedback"; fb.textContent = ""; 
}
</script>

</body>
</html>
